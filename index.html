<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Dorsz 1.0 ‚Äì Tw√≥j Asystent</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body, html { width:100%; height:100%; font-family:Arial,sans-serif; }
body { display:flex; background:#111; color:#eee; }

/* ===== SIDEBAR ===== */
#sidebar {
  width:250px;
  background:#1f1f1f;
  border-right:1px solid #333;
  display:flex;
  flex-direction:column;
  transition: width 0.3s;
  position: relative;
}
#sidebar.collapsed { width:50px; }

#sidebar .top {
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px;
}
#sidebar .logo {
  width:40px; height:40px;
  background:#4fc3f7;
  border-radius:6px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  font-size:20px;
  color:#000;
}
#sidebar .collapseBtn {
  background:none; border:none; color:#fff; cursor:pointer; font-size:18px;
}

#sidebar .addBtn { margin:10px; padding:8px; background:#81c784; border:none; border-radius:6px; cursor:pointer; color:#000; }

#searchChats { margin:10px; padding:6px 8px; border-radius:4px; border:none; background:#2a2a2a; color:#fff; width:calc(100% - 20px); }

#chatList { flex:1; overflow-y:auto; margin:5px 0; }

.chatBtn { padding:10px; border:none; background:none; color:#fff; text-align:left; font-size:14px; cursor:pointer; display:flex; justify-content:space-between; align-items:center; }
.chatBtn:hover { background:#333; }

#profile {
  padding:10px;
  border-top:1px solid #333;
  font-size:12px;
  display:flex;
  flex-direction:column;
}
#profile .actions { margin-top:5px; display:flex; gap:5px; }

/* ===== MAIN ===== */
#main { flex:1; display:flex; flex-direction:column; }
#chat { flex:1; padding:20px; overflow-y:auto; }
.msg { margin:8px 0; line-height:1.5; }
.user { color:#4fc3f7; }
.ai { color:#81c784; white-space:pre-wrap; background:#222; padding:10px; border-radius:6px; position:relative; }
.ai button.copyBtn { position:absolute; top:8px; right:8px; font-size:12px; padding:2px 6px; border:none; border-radius:4px; cursor:pointer; }

/* ===== INPUT ===== */
#input-container { display:flex; padding:10px; background:#1c1c1c; border-top:1px solid #333; }
#input { flex:1; padding:12px; border:none; border-radius:6px; background:#2a2a2a; color:#fff; font-size:16px; }
#send { padding:12px 18px; background:#4fc3f7; border:none; border-radius:6px; margin-left:10px; color:#000; font-weight:bold; cursor:pointer; }
#send:hover { background:#36a0d1; }
#voiceBtn { margin-left:10px; background:#81c784; color:#000; border:none; border-radius:6px; padding:12px; cursor:pointer; }
#fileInput { margin-left:10px; padding:8px; border-radius:6px; border:none; background:#2a2a2a; color:#fff; }

</style>
</head>
<body>

<div id="sidebar">
  <div class="top">
    <div class="logo">D</div>
    <button class="collapseBtn" onclick="toggleSidebar()">‚¨ÖÔ∏è</button>
  </div>
  <button class="addBtn" onclick="newChat()">+ Nowy Chat / Plik</button>
  <input type="text" id="searchChats" placeholder="üîç Szukaj czat√≥w" oninput="filterChats()">
  <div id="chatList"></div>
  <div id="profile">
    <div>Profil u≈ºytkownika</div>
    <div class="actions">
      <button onclick="alert('Udostƒôpnij')">Udostƒôpnij</button>
      <button onclick="alert('Dodaj osobƒô')">Dodaj</button>
      <button onclick="alert('Menu')">‚ãÆ</button>
    </div>
  </div>
</div>

<div id="main">
  <div id="chat"></div>
  <div id="input-container">
    <input id="input" placeholder="Wpisz wiadomo≈õƒá..." onkeydown="if(event.key==='Enter'){send();}">
    <button id="send" onclick="send()">Wy≈õlij</button>
    <button id="voiceBtn" onclick="startDictation()">üé§</button>
    <input type="file" id="fileInput">
  </div>
</div>

<script>
// ===== DANE =====
let chats = JSON.parse(localStorage.getItem("dorszChats") || "[]");
let currentChatIndex = null;

// ===== SIDEBAR =====
function refreshChatList() {
  const list = document.getElementById("chatList");
  list.innerHTML = "";
  chats.forEach((chat, index) => {
    const btn = document.createElement("button");
    btn.className = "chatBtn";
    btn.textContent = chat.title;
    btn.onclick = () => loadChat(index);
    list.appendChild(btn);
  });
}

function newChat() {
  const title = prompt("Nazwa czatu:") || ("Czat " + (chats.length+1));
  chats.push({ title, messages: [] });
  currentChatIndex = chats.length-1;
  saveChats();
  refreshChatList();
  renderChat();
}

function filterChats() {
  const q = document.getElementById("searchChats").value.toLowerCase();
  document.querySelectorAll("#chatList button").forEach(btn => {
    btn.style.display = btn.textContent.toLowerCase().includes(q) ? "" : "none";
  });
}

function toggleSidebar() {
  document.getElementById("sidebar").classList.toggle("collapsed");
}

function saveChats() { localStorage.setItem("dorszChats", JSON.stringify(chats)); }
function loadChat(index) { currentChatIndex = index; renderChat(); }

// ===== CHAT =====
function renderChat() {
  const chatElem = document.getElementById("chat");
  chatElem.innerHTML = "";
  if(currentChatIndex===null) return;
  const msgs = chats[currentChatIndex].messages;
  msgs.forEach(m=>{
    const div = document.createElement("div");
    div.className = "msg "+(m.from==="user"?"user":"ai");
    if(m.from==="ai"){
      const textDiv = document.createElement("div");
      textDiv.textContent = m.text;
      const copyBtn = document.createElement("button");
      copyBtn.textContent="üìã Kopiuj";
      copyBtn.className="copyBtn";
      copyBtn.onclick=()=>{navigator.clipboard.writeText(m.text).then(()=>{copyBtn.textContent="‚úÖ Skopiowano!"; setTimeout(()=>copyBtn.textContent="üìã Kopiuj",1000);})};
      div.appendChild(textDiv);
      div.appendChild(copyBtn);
    } else div.textContent = m.text;
    chatElem.appendChild(div);
  });
  chatElem.scrollTop = chatElem.scrollHeight;
}

// ===== WIADOMO≈öCI =====
function addMessage(from,text){if(currentChatIndex===null)newChat();chats[currentChatIndex].messages.push({from,text});renderChat();saveChats();}

// ===== LOGIKA DORSZA =====
function processMessage(text){
  const l=text.toLowerCase().trim();
  const greetings=["hej","cze≈õƒá","witaj","siema","dzie≈Ñ dobry"];
  if(greetings.includes(l)){
    const responses=["Hej! Mi≈Ço Ciƒô widzieƒá. Co dzisiaj tworzymy?","Cze≈õƒá! Gotowy, by naprawiaƒá kod i tworzyƒá pluginy?","Witaj! Masz jaki≈õ problem z projektem, czy chcesz pogadaƒá o kodzie?","Siema! Mogƒô od razu spojrzeƒá na Tw√≥j kod albo wygenerowaƒá co≈õ nowego."];
    const reply=responses[Math.floor(Math.random()*responses.length)]; speak(reply); return reply;
  }
  if(l.includes("jak siƒô masz")){const replies=["Wszystko super, gotowy do pracy nad Twoimi projektami!","≈öwietnie, dziƒôki! A Ty jak siƒô masz?","Dobrze! Gotowy do naprawy b≈Çƒôd√≥w i tworzenia kodu!"]; const reply=replies[Math.floor(Math.random()*replies.length)]; speak(reply); return reply;}
  if(l.includes("co tam")||l.includes("co s≈Çychaƒá")){const replies=["Trochƒô kodujƒô w pamiƒôci, a Ty?","Sprawdzam Twoje projekty, gotowy do akcji!","PrzeglƒÖdam kod i my≈õlƒô o nowych pluginach."]; const reply=replies[Math.floor(Math.random()*replies.length)]; speak(reply); return reply;}
  if(l.includes("<html")||l.includes("function")||l.includes("alert(")){let out=text;if(text.includes("alert('")&&!text.includes("');")){out=text.replace(/alert\('(.+?)'\)/,"alert('$1');");speak("Poprawi≈Çem ≈õrednik w Twoim kodzie.");return"Poprawi≈Çem ≈õrednik:\n"+out;}return"WyglƒÖda jak kod. Opisz, co ma robiƒá lub wklej wiƒôcej, a poprawiƒô go.";}
  if(l.includes("stw√≥rz obraz")||l.includes("generuj obraz")){speak("Przygotowa≈Çem placeholder dla obrazu. W prawdziwej wersji mo≈ºna po≈ÇƒÖczyƒá z API generujƒÖcym obraz."); return "üåÑ Obraz wygenerowany (placeholder)";}
  return "Nie jestem pewien, proszƒô podaj wiƒôcej szczeg√≥≈Ç√≥w lub wklej kod do analizy.";
}

// ===== WYSY≈ÅANIE =====
function send(){const inp=document.getElementById("input");const txt=inp.value.trim();if(!txt)return;addMessage("user",txt);inp.value="";const reply=processMessage(txt);addMessage("ai",reply);}

// ===== TTS =====
function speak(text){const utterance=new SpeechSynthesisUtterance(text);utterance.lang='pl-PL';utterance.rate=1;speechSynthesis.speak(utterance);}

// ===== STT =====
function startDictation(){if(!('webkitSpeechRecognition' in window)){alert("Twoja przeglƒÖdarka nie wspiera rozpoznawania mowy.");return;}const recognition=new webkitSpeechRecognition();recognition.lang='pl-PL';recognition.interimResults=false;recognition.onresult=function(e){const spoken=e.results[0][0].transcript;document.getElementById('input').value=spoken;};recognition.start();}

// ===== PLIKI =====
document.getElementById('fileInput').addEventListener('change',function(e){const file=e.target.files[0];const reader=new FileReader();reader.onload=function(){const content=reader.result;addMessage("user",`Plik za≈Çadowany: ${file.name}`);addMessage("ai","Oto zawarto≈õƒá pliku:\n"+content.substring(0,1000)+"\n(...)");};reader.readAsText(file);});

// ===== INIT =====
refreshChatL
