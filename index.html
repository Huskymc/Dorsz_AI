<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Dorsz 1.0 ‚Äì Tw√≥j Asystent</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body, html { width:100%; height:100%; font-family:Arial,sans-serif; background:#222; color:#eee; display:flex; }
#sidebar { width:250px; background:#1f1f1f; display:flex; flex-direction:column; transition: width 0.3s; border-right:1px solid #333; position:relative; }
#sidebar.collapsed { width:50px; }
#sidebar .top { display:flex; align-items:center; justify-content:space-between; padding:10px; }
#sidebar .logo { width:40px; height:40px; background:#4fc3f7; border-radius:6px; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:20px; color:#000; }
#sidebar .collapseBtn { background:none; border:none; color:#fff; cursor:pointer; font-size:18px; }
#sidebar .addBtn { margin:10px; padding:8px; background:#81c784; border:none; border-radius:6px; cursor:pointer; color:#000; }
#searchChats { margin:10px; padding:6px 8px; border-radius:4px; border:none; background:#2a2a2a; color:#fff; width:calc(100% - 20px); }
#chatList { flex:1; overflow-y:auto; margin:5px 0; }
.chatBtn { padding:10px; border:none; background:none; color:#fff; text-align:left; font-size:14px; cursor:pointer; display:flex; justify-content:space-between; align-items:center; }
.chatBtn:hover { background:#333; }
#profile { padding:10px; border-top:1px solid #333; font-size:12px; display:flex; flex-direction:column; }
#profile .actions { margin-top:5px; display:flex; gap:5px; }
#main { flex:1; display:flex; flex-direction:column; }
#chat { flex:1; padding:20px; overflow-y:auto; }
.msg { margin:8px 0; line-height:1.5; }
.user { color:#4fc3f7; }
.ai { color:#81c784; white-space:pre-wrap; background:#222; padding:10px; border-radius:6px; position:relative; }
.ai button.copyBtn { position:absolute; top:8px; right:8px; font-size:12px; padding:2px 6px; border:none; border-radius:4px; cursor:pointer; }
#input-container { display:flex; padding:10px; background:#1c1c1c; border-top:1px solid #333; }
#input { flex:1; padding:12px; border:none; border-radius:6px; background:#2a2a2a; color:#fff; font-size:16px; }
#send { padding:12px 18px; background:#4fc3f7; border:none; border-radius:6px; margin-left:10px; color:#000; font-weight:bold; cursor:pointer; }
#send:hover { background:#36a0d1; }
#voiceBtn { margin-left:10px; background:#81c784; color:#000; border:none; border-radius:6px; padding:12px; cursor:pointer; }
#fileInput { margin-left:10px; padding:8px; border-radius:6px; border:none; background:#2a2a2a; color:#fff; }
#imageOutput { margin-top:10px; width:100%; height:200px; background:#333; border-radius:6px; display:flex; align-items:center; justify-content:center; color:#aaa; font-size:14px; }
</style>
</head>
<body>

<div id="sidebar">
  <div class="top">
    <div class="logo">D</div>
    <button class="collapseBtn" onclick="toggleSidebar()">‚¨ÖÔ∏è</button>
  </div>
  <button class="addBtn" onclick="newChat()">+ Nowy Chat / Plik</button>
  <input type="text" id="searchChats" placeholder="üîç Szukaj czat√≥w" oninput="filterChats()">
  <div id="chatList"></div>
  <div id="profile">
    <div>Profil u≈ºytkownika</div>
    <div class="actions">
      <button onclick="alert('Udostƒôpnij')">Udostƒôpnij</button>
      <button onclick="alert('Dodaj osobƒô')">Dodaj</button>
      <button onclick="alert('Menu')">‚ãÆ</button>
    </div>
  </div>
</div>

<div id="main">
  <div id="chat"></div>
  <div id="imageOutput">Tu pojawi siƒô wygenerowany obraz</div>
  <div id="input-container">
    <input id="input" placeholder="Wpisz wiadomo≈õƒá..." onkeydown="if(event.key==='Enter'){send();}">
    <button id="send" onclick="send()">Wy≈õlij</button>
    <button id="voiceBtn" onclick="startDictation()">üé§</button>
    <input type="file" id="fileInput">
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){

// ===== DANE =====
let chats = JSON.parse(localStorage.getItem("dorszChats") || "[]");
let currentChatIndex = null;

// ===== DOMY≈öLNY CZAT =====
if(chats.length === 0){
  chats.push({title:"Czat startowy", messages:[]});
  currentChatIndex = 0;
  localStorage.setItem("dorszChats", JSON.stringify(chats));
}

// ===== SIDEBAR =====
function refreshChatList() {
  const list = document.getElementById("chatList");
  list.innerHTML = "";
  chats.forEach((chat, index) => {
    const btn = document.createElement("button");
    btn.className = "chatBtn";
    btn.textContent = chat.title;
    btn.onclick = () => loadChat(index);
    list.appendChild(btn);
  });
}

function newChat() {
  const title = prompt("Nazwa czatu:") || ("Czat " + (chats.length+1));
  chats.push({ title, messages: [] });
  currentChatIndex = chats.length-1;
  saveChats();
  refreshChatList();
  renderChat();
}

function filterChats() {
  const q = document.getElementById("searchChats").value.toLowerCase();
  document.querySelectorAll("#chatList button").forEach(btn => {
    btn.style.display = btn.textContent.toLowerCase().includes(q) ? "" : "none";
  });
}

function toggleSidebar() {
  document.getElementById("sidebar").classList.toggle("collapsed");
}

function saveChats() { localStorage.setItem("dorszChats", JSON.stringify(chats)); }
function loadChat(index) { currentChatIndex = index; renderChat(); }

// ===== CHAT =====
function renderChat() {
  const chatElem = document.getElementById("chat");
  chatElem.innerHTML = "";
  if(currentChatIndex===null) return;
  const msgs = chats[currentChatIndex].messages;
  msgs.forEach(m=>{
    const div = document.createElement("div");
    div.className = "msg "+(m.from==="user"?"user":"ai");
    if(m.from==="ai"){
      const textDiv = document.createElement("div");
      textDiv.textContent = m.text;
      const copyBtn = document.createElement("button");
      copyBtn.textContent="üìã Kopiuj";
      copyBtn.className="copyBtn";
      copyBtn.onclick=()=>{navigator.clipboard.writeText(m.text).then(()=>{copyBtn.textContent="‚úÖ Skopiowano!"; setTimeout(()=>copyBtn.textContent="üìã Kopiuj",1000);})};
      div.appendChild(textDiv);
      div.appendChild(copyBtn);
    } else div.textContent = m.text;
    chatElem.appendChild(div);
  });
  chatElem.scrollTop = chatElem.scrollHeight;
}

// ===== WIADOMO≈öCI =====
function addMessage(from,text){if(currentChatIndex===null)newChat();chats[currentChatIndex].messages.push({from,text});renderChat();saveChats();}

// ===== LOGIKA DORSZA 1.0 =====
function processMessage(text){
  // Analiza ka≈ºdej wiadomo≈õci indywidualnie
  let reply="";
  if(text.trim()==="") return "Nie otrzyma≈Çem ≈ºadnej wiadomo≈õci.";
  
  if(text.includes("kod") || text.includes("function") || text.includes("<html")){
    // Symulacja analizy kodu i poprawki
    reply="Analizujƒô Tw√≥j kod...\n";
    setTimeout(()=>{},100); // symulacja przetwarzania
    reply+="WyglƒÖda poprawnie, ewentualnie dodaj ≈õredniki i sprawd≈∫ sk≈Çadniƒô.\n";
    return reply;
  }
  
  if(text.includes("stw√≥rz obraz")||text.includes("generuj obraz")){
    generateImage();
    return "üåÑ Obraz zosta≈Ç wygenerowany (lokalny placeholder)";
  }
  
  // Normalna wiadomo≈õƒá
  reply="Analizujƒô TwojƒÖ wiadomo≈õƒá: \""+text+"\"\nSugestia: mogƒô sprawdziƒá kod lub wygenerowaƒá obraz.";
  return reply;
}

// ===== WYSY≈ÅANIE =====
function send(){
  const inp=document.getElementById("input");
  const txt=inp.value.trim();
  if(!txt)return;
  addMessage("user",txt);
  inp.value="";
  const reply=processMessage(txt);
  addMessage("ai",reply);
  speak(reply);
}

// ===== TTS =====
function speak(text){
  try {
    const utterance=new SpeechSynthesisUtterance(text);
    utterance.lang='pl-PL'; utterance.rate=1;
    speechSynthesis.speak(utterance);
  } catch(e){console.warn("TTS nie dzia≈Ça w tej przeglƒÖdarce");}
}

// ===== STT =====
function startDictation(){
  try {
    if(!('webkitSpeechRecognition' in window)){alert("Twoja przeglƒÖdarka nie wspiera rozpoznawania mowy."); return;}
    const recognition=new webkitSpeechRecognition();
    recognition.lang='pl-PL';
    recognition.interimResults=false;
    recognition.onresult=function(e){document.getElementById('input').value=e.results[0][0].transcript;};
    recognition.start();
  } catch(e){alert("Rozpoznawanie mowy nie dzia≈Ça w tej przeglƒÖdarce");}
}

// ===== PLIKI =====
document.getElementById('fileInput').addEventListener('change',function(e){
  const file=e.target.files[0];
  const reader=new FileReader();
  reader.onload=function(){
    const content=reader.result;
    addMessage("user",`Plik za≈Çadowany: ${file.name}`);
    addMessage("ai","Oto zawarto≈õƒá pliku:\n"+content.substring(0,1000)+"\n(...)");
  };
  reader.readAsText(file);
});

// ===== GENEROWANIE OBRAZU LOKALNIE =====
function generateImage(){
  const canvas = document.createElement("canvas");
  canvas.width=400; canvas.height=200;
  const ctx=canvas.getContext("2d");
  ctx.fillStyle="#444"; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#fff"; ctx.font="20px Arial"; ctx.fillText("Obraz wygenerowany przez Dorsza 1.0",10,50);
  const output=document.getElementById("imageOutput");
  output.innerHTML="";
  output.appendChild(canvas);
}

// ===== INIT =====
refreshChatList(); renderChat();

});
</script>

</body>
</html>
