<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Dorsz 6.1 â€“ Multimodalny Asystent</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body, html { width:100%; height:100%; font-family:Arial,sans-serif; }
body { display:flex; background:#111; color:#eee; }

/* SIDEBAR */
#sidebar {
  width:250px;
  background:#1f1f1f;
  border-right:1px solid #333;
  display:flex;
  flex-direction:column;
}
#sidebar button {
  padding:12px;
  border:none;
  background:none;
  color:#fff;
  text-align:left;
  font-size:16px;
  cursor:pointer;
}
#sidebar button:hover { background:#333; }
#sidebar input {
  margin:10px;
  padding:8px;
  border-radius:4px;
  border:none;
  background:#2a2a2a;
  color:#fff;
}
#chatList { flex:1; overflow-y:auto; }

/* MAIN CHAT */
#main { flex:1; display:flex; flex-direction:column; }
#chat { flex:1; padding:20px; overflow-y:auto; }
.msg { margin:8px 0; line-height:1.5; }
.user { color:#4fc3f7; }
.ai   { color:#81c784; white-space:pre-wrap; background:#222; padding:10px; border-radius:6px; position:relative; }
.ai button.copyBtn {
  position:absolute; top:8px; right:8px; font-size:12px; padding:2px 6px; border:none; border-radius:4px; cursor:pointer;
}

/* INPUT */
#input-container { display:flex; padding:10px; background:#1c1c1c; border-top:1px solid #333; }
#input { flex:1; padding:12px; border:none; border-radius:6px; background:#2a2a2a; color:#fff; font-size:16px; }
#send { padding:12px 18px; background:#4fc3f7; border:none; border-radius:6px; margin-left:10px; color:#000; font-weight:bold; cursor:pointer; }
#send:hover { background:#36a0d1; }
#voiceBtn { margin-left:10px; background:#81c784; color:#000; border:none; border-radius:6px; padding:12px; cursor:pointer; }
#fileInput { margin-left:10px; padding:8px; border-radius:6px; border:none; background:#2a2a2a; color:#fff; }
</style>
</head>
<body>

<div id="sidebar">
  <button onclick="newChat()">ðŸ†• Nowy Chat</button>
  <input type="text" id="searchChats" placeholder="ðŸ” Szukaj czatÃ³w" oninput="filterChats()">
  <div id="chatList"></div>
</div>

<div id="main">
  <div id="chat"></div>
  <div id="input-container">
    <input id="input" placeholder="Wklej kod lub opisz problem...">
    <button id="send" onclick="send()">WyÅ›lij</button>
    <button id="voiceBtn" onclick="startDictation()">ðŸŽ¤</button>
    <input type="file" id="fileInput">
  </div>
</div>

<script>
// ========== Dane ==========
let chats = JSON.parse(localStorage.getItem("dorszChats") || "[]");
let currentChatIndex = null;

// ========== Sidebar ==========
function refreshChatList() {
  const list = document.getElementById("chatList");
  list.innerHTML = "";
  chats.forEach((chat, index) => {
    const btn = document.createElement("button");
    btn.textContent = chat.title;
    btn.onclick = () => loadChat(index);
    list.appendChild(btn);
  });
}
function newChat() {
  const title = prompt("Nazwa czatu:") || ("Czat " + (chats.length+1));
  chats.push({ title, messages: [] });
  currentChatIndex = chats.length-1;
  saveChats();
  refreshChatList();
  renderChat();
}
function filterChats() {
  const q = document.getElementById("searchChats").value.toLowerCase();
  document.querySelectorAll("#chatList button").forEach(btn => {
    btn.style.display = btn.textContent.toLowerCase().includes(q) ? "" : "none";
  });
}
function saveChats() { localStorage.setItem("dorszChats", JSON.stringify(chats)); }
function loadChat(index) { currentChatIndex = index; renderChat(); }

// ========== Render czatu ==========
function renderChat() {
  const chatElem = document.getElementById("chat");
  chatElem.innerHTML = "";
  if (currentChatIndex === null) return;
  const msgs = chats[currentChatIndex].messages;
  msgs.forEach((m, i) => {
    const div = document.createElement("div");
    div.className = "msg " + (m.from==="user"?"user":"ai");

    if(m.from === "ai") {
      const textDiv = document.createElement("div");
      textDiv.textContent = m.text;
      textDiv.style.whiteSpace = "pre-wrap";

      const copyBtn = document.createElement("button");
      copyBtn.textContent = "ðŸ“‹ Kopiuj";
      copyBtn.className = "copyBtn";
      copyBtn.onclick = () => {
        navigator.clipboard.writeText(m.text).then(() => {
          copyBtn.textContent = "âœ… Skopiowano!";
          setTimeout(() => copyBtn.textContent = "ðŸ“‹ Kopiuj", 1000);
        });
      };

      div.appendChild(textDiv);
      div.appendChild(copyBtn);
    } else {
      div.textContent = m.text;
    }

    chatElem.appendChild(div);
  });
  chatElem.scrollTop = chatElem.scrollHeight;
}

// ========== Dodawanie wiadomoÅ›ci ==========
function addMessage(from, text) {
  if (currentChatIndex === null) newChat();
  chats[currentChatIndex].messages.push({ from, text });
  renderChat();
  saveChats();
}

// ========== Logika Dorsza ==========
function processMessage(text) {
  const l = text.toLowerCase().trim();

  // Powitania
  if (l === "hej" || l==="czeÅ›Ä‡" || l==="witaj") {
    speak("Witaj! W czym mogÄ™ Ci pomÃ³c dzisiaj?");
    return "Witaj! W czym mogÄ™ Ci pomÃ³c dzisiaj?";
  }

  // Komendy
  if (l === "/status") return `Dorsz 6.1: Tryb help, gotowy.`;
  if (l === "/help") return "MoÅ¼esz pisaÄ‡ powitania, prosiÄ‡ o naprawÄ™ kodu, pluginÃ³w, HTML/JS i generowanie obrazÃ³w.";

  // Kod HTML/JS/CSS
  if (l.includes("<html") || l.includes("function") || l.includes("alert(")) {
    let out = text;
    if (text.includes("alert('") && !text.includes("');")) {
      out = text.replace(/alert\('(.+?)'\)/, "alert('$1');");
      speak("PoprawiÅ‚em Å›rednik w Twoim kodzie.");
      return "PoprawiÅ‚em Å›rednik:\n" + out;
    }
    return "WyglÄ…da jak kod. Opisz, co ma robiÄ‡ lub wklej wiÄ™cej, a poprawiÄ™ go.";
  }

  // Generowanie obrazÃ³w (placeholder)
  if (l.includes("stwÃ³rz obraz") || l.includes("generuj obraz")) {
    speak("PrzygotowaÅ‚em placeholder dla obrazu. W prawdziwej wersji moÅ¼na poÅ‚Ä…czyÄ‡ z API generujÄ…cym obraz.");
    return "ðŸŒ„ Obraz wygenerowany (placeholder)";
  }

  return "Nie jestem pewien, proszÄ™ podaj wiÄ™cej szczegÃ³Å‚Ã³w lub wklej kod do analizy.";
}

// ========== WysyÅ‚anie wiadomoÅ›ci ==========
function send() {
  const inp = document.getElementById("input");
  const txt = inp.value.trim();
  if (!txt) return;
  addMessage("user", txt);
  inp.value = "";
  const reply = processMessage(txt);
  addMessage("ai", reply);
}

// ========== Text-to-Speech ==========
function speak(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'pl-PL';
  utterance.rate = 1;
  speechSynthesis.speak(utterance);
}

// ========== Speech-to-Text ==========
function startDictation() {
  if (!('webkitSpeechRecognition' in window)) { alert("Twoja przeglÄ…darka nie wspiera rozpoznawania mowy."); return; }
  const recognition = new webkitSpeechRecognition();
  recognition.lang = 'pl-PL';
  recognition.interimResults = false;
  recognition.onresult = function(event) {
    const spoken = event.results[0][0].transcript;
    document.getElementById('input').value = spoken;
  };
  recognition.start();
}

// ========== Dodawanie plikÃ³w ==========
document.getElementById('fileInput').addEventListener('change', function(e){
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = function() {
    const content = reader.result;
    addMessage("user", `Plik zaÅ‚adowany: ${file.name}`);
    addMessage("ai", "Oto zawartoÅ›Ä‡ pliku:\n" + content.substring(0,1000)+"\n(...)"); 
  };
  reader.readAsText(file);
});

// ========== Init ==========
refreshChatList();
renderChat();
</script>

</body>
</html>
